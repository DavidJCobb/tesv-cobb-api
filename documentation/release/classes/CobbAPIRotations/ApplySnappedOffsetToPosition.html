<!doctype html><html><head>
      <meta charset="UTF-8">
      <link rel="stylesheet" href="../../resources/main.css">
   <title>ApplySnappedOffsetToPosition - CobbAPIRotations - CobbAPI Documentation</title></head>
   <body>
      <nav id="sidebar" t-context="index">
         <h1>Navigation</h1>
         <a href="../../index.html">Index</a>
         <h2>Classes</h2>
         <ul>
            
               <li data-class-name="CobbAPI" data-class-file="CobbAPI.xml">
                  
                  
                  <a href="../../classes/CobbAPI.html">
                     
                     CobbAPI
                  </a>
               </li>
            
               <li data-class-name="CobbAPIAcousticSpace" data-class-file="AcousticSpace.xml">
                  
                  
                  <a href="../../classes/CobbAPIAcousticSpace.html">
                     
                     CobbAPIAcousticSpace
                  </a>
               </li>
            
               <li data-class-name="CobbAPIActor" data-class-file="Actor.xml">
                  
                  
                  <a href="../../classes/CobbAPIActor.html">
                     
                     CobbAPIActor
                  </a>
               </li>
            
               <li data-class-name="CobbAPIArray" data-class-file="Array.xml">
                  
                  
                  <a href="../../classes/CobbAPIArray.html">
                     
                     CobbAPIArray
                  </a>
               </li>
            
               <li data-class-name="CobbAPIBatchMove" data-class-file="BatchMove.xml">
                  
                  
                  <a href="../../classes/CobbAPIBatchMove.html">
                     
                     CobbAPIBatchMove
                  </a>
               </li>
            
               <li data-class-name="CobbAPIBatchMoveGroup" data-class-file="BatchMoveGroup.xml">
                  
                  
                  <a href="../../classes/CobbAPIBatchMoveGroup.html">
                     
                     CobbAPIBatchMoveGroup
                  </a>
               </li>
            
               <li data-class-name="CobbAPIBatchMoveRel" data-class-file="BatchMoveRel.xml">
                  
                  
                  <a href="../../classes/CobbAPIBatchMoveRel.html">
                     
                     CobbAPIBatchMoveRel
                  </a>
               </li>
            
               <li data-class-name="CobbAPIBatchSetMotionType" data-class-file="BatchSetMotionType.xml">
                  
                  
                  <a href="../../classes/CobbAPIBatchSetMotionType.html">
                     
                     CobbAPIBatchSetMotionType
                  </a>
               </li>
            
               <li data-class-name="CobbAPIBatchSpawnComplex" data-class-file="BatchSpawnComplex.xml">
                  
                  
                  <a href="../../classes/CobbAPIBatchSpawnComplex.html">
                     
                     CobbAPIBatchSpawnComplex
                  </a>
               </li>
            
               <li data-class-name="CobbAPIBatchSpawnRel" data-class-file="BatchSpawnRel.xml">
                  
                  
                  <a href="../../classes/CobbAPIBatchSpawnRel.html">
                     
                     CobbAPIBatchSpawnRel
                  </a>
               </li>
            
               <li data-class-name="CobbAPICell" data-class-file="Cell.xml">
                  
                  
                  <a href="../../classes/CobbAPICell.html">
                     
                     CobbAPICell
                  </a>
               </li>
            
               <li data-class-name="CobbAPICellSearcher" data-class-file="CellSearcher.xml">
                  
                  
                  <a href="../../classes/CobbAPICellSearcher.html">
                     
                     CobbAPICellSearcher
                  </a>
               </li>
            
               <li data-class-name="CobbAPIDetection" data-class-file="Detection.xml">
                  
                  
                  <a href="../../classes/CobbAPIDetection.html">
                     
                     CobbAPIDetection
                  </a>
               </li>
            
               <li data-class-name="CobbAPIForm" data-class-file="Form.xml">
                  
                  
                  <a href="../../classes/CobbAPIForm.html">
                     
                     CobbAPIForm
                  </a>
               </li>
            
               <li data-class-name="CobbAPIFurniture" data-class-file="Furniture.xml">
                  
                  
                  <a href="../../classes/CobbAPIFurniture.html">
                     
                     CobbAPIFurniture
                  </a>
               </li>
            
               <li data-class-name="CobbAPIGame" data-class-file="Game.xml">
                  
                  
                  <a href="../../classes/CobbAPIGame.html">
                     
                     CobbAPIGame
                  </a>
               </li>
            
               <li data-class-name="CobbAPIImageSpace" data-class-file="ImageSpace.xml">
                  
                  
                  <a href="../../classes/CobbAPIImageSpace.html">
                     
                     CobbAPIImageSpace
                  </a>
               </li>
            
               <li data-class-name="CobbAPILight" data-class-file="Light.xml">
                  
                  
                  <a href="../../classes/CobbAPILight.html">
                     
                     CobbAPILight
                  </a>
               </li>
            
               <li data-class-name="CobbAPILightingTemplate" data-class-file="LightingTemplate.xml">
                  
                  
                  <a href="../../classes/CobbAPILightingTemplate.html">
                     
                     CobbAPILightingTemplate
                  </a>
               </li>
            
               <li data-class-name="CobbAPIMessage" data-class-file="Message.xml">
                  
                  
                  <a href="../../classes/CobbAPIMessage.html">
                     
                     CobbAPIMessage
                  </a>
               </li>
            
               <li data-class-name="CobbAPIObjectReference" data-class-file="ObjectReference.xml">
                  
                  
                  <a href="../../classes/CobbAPIObjectReference.html">
                     
                     CobbAPIObjectReference
                  </a>
               </li>
            
               <li data-class-name="CobbAPIRevealService" data-class-file="RevealService.xml">
                  
                  
                  <a href="../../classes/CobbAPIRevealService.html">
                     
                     CobbAPIRevealService
                  </a>
               </li>
            
               <li data-class-name="CobbAPIRotations" data-class-file="Rotations.xml" class="selected">
                  
                  
                  <a href="../../classes/CobbAPIRotations.html">
                     
                     CobbAPIRotations
                  </a>
               
         <ul>
            
               <li data-method-name="ApplyRelativeCoordinates">
                  
                  <a href="../../classes/CobbAPIRotations/ApplyRelativeCoordinates.html">
                     
                     ApplyRelativeCoordinates
                  </a>
               </li>
            
               <li data-method-name="ApplyTransformationMatrix">
                  
                  <a href="../../classes/CobbAPIRotations/ApplyTransformationMatrix.html">
                     
                     ApplyTransformationMatrix
                  </a>
               </li>
            
               <li data-method-name="ApplySnappedOffsetToPosition" class="selected">
                  
                  <span>
                     
                     ApplySnappedOffsetToPosition
                  </span>
               </li>
            
               <li data-method-name="ComputeTransformationMatrix">
                  
                  <a href="../../classes/CobbAPIRotations/ComputeTransformationMatrix.html">
                     
                     ComputeTransformationMatrix
                  </a>
               </li>
            
               <li data-method-name="GetRelativeCoordinates">
                  
                  <a href="../../classes/CobbAPIRotations/GetRelativeCoordinates.html">
                     
                     GetRelativeCoordinates
                  </a>
               </li>
            
         </ul>
      </li>
            
               <li data-class-name="CobbAPIShout" data-class-file="Shout.xml">
                  
                  
                  <a href="../../classes/CobbAPIShout.html">
                     
                     CobbAPIShout
                  </a>
               </li>
            
               <li data-class-name="CobbAPISimpleSearches" data-class-file="SimpleSearches.xml">
                  
                  
                  <a href="../../classes/CobbAPISimpleSearches.html">
                     
                     CobbAPISimpleSearches
                  </a>
               </li>
            
               <li data-class-name="CobbAPIString" data-class-file="String.xml">
                  
                  
                  <a href="../../classes/CobbAPIString.html">
                     
                     CobbAPIString
                  </a>
               </li>
            
               <li data-class-name="CobbAPIUtility" data-class-file="Utility.xml">
                  
                  
                  <a href="../../classes/CobbAPIUtility.html">
                     
                     CobbAPIUtility
                  </a>
               </li>
            
               <li data-class-name="CobbAPIWorldspace" data-class-file="Worldspace.xml">
                  
                  
                  <a href="../../classes/CobbAPIWorldspace.html">
                     
                     CobbAPIWorldspace
                  </a>
               </li>
            
         </ul>
         <h2>Concepts</h2>
         <ul>
            
               <li data-concept-name="Actor values">
                  
                  <a href="../../concepts/Actor values.html">
                     
                     Actor values
                  </a>
               </li>
            
         
               <li data-concept-name="Changeflags">
                  
                  <a href="../../concepts/Changeflags.html">
                     
                     Changeflags
                  </a>
               </li>
            
         
               <li data-concept-name="Detection events">
                  
                  <a href="../../concepts/Detection events.html">
                     
                     Detection events
                  </a>
               </li>
            
         
               <li data-concept-name="Load doors">
                  
                  <a href="../../concepts/Load doors.html">
                     
                     Load doors
                  </a>
               </li>
            
         </ul>
      </nav>
      <main>
         <h1>ApplySnappedOffsetToPosition</h1>
         <p>
               This is a shortcut function for the math that Cobb Positioner performs when 
               moving an object while a "snap target" is set (akin to moving something in the 
               Creation Kit with "Snap to Reference" active). It takes the object's current 
               position, the (local) offset by which to move it, the snap size, and information 
               on the snap target's rotation. From this, it produces the position to which the 
               object should be moved.
            </p>
            <p>
               This function is equivalent to the following Papyrus code:
            </p>
            <pre>Float[] vLocal = new Float[3]
vLocal[0] = afMatrixTransformToLocal[0]*afBasePosition[0] + afMatrixTransformToLocal[1]*afBasePosition[1] + afMatrixTransformToLocal[2]*afBasePosition[2]
vLocal[1] = afMatrixTransformToLocal[3]*afBasePosition[0] + afMatrixTransformToLocal[4]*afBasePosition[1] + afMatrixTransformToLocal[5]*afBasePosition[2]
vLocal[2] = afMatrixTransformToLocal[6]*afBasePosition[0] + afMatrixTransformToLocal[7]*afBasePosition[1] + afMatrixTransformToLocal[8]*afBasePosition[2]
If aiSnapUnits
   ;
   ; Now snap the thing.
   ;
   ; The offset variable pretty much offsets the grid we're snapping to, to 
   ; match the position of the snap target. We'd normally just use a simple 
   ; modulus (pos local % pos snap), but Papyrus doesn't support modulus on 
   ; non-integers.
   ;
   Float[] fOffsets = new Float[3]
   fOffsets[0] = (afSnapPosition[0] as int) % aiSnapUnits + (afSnapPosition[0] - (afSnapPosition[0] as int))
   fOffsets[1] = (afSnapPosition[1] as int) % aiSnapUnits + (afSnapPosition[1] - (afSnapPosition[1] as int))
   fOffsets[2] = (afSnapPosition[2] as int) % aiSnapUnits + (afSnapPosition[2] - (afSnapPosition[2] as int))
   vLocal[0] = vLocal[0] - fOffsets[0]
   vLocal[1] = vLocal[1] - fOffsets[1]
   vLocal[2] = vLocal[2] - fOffsets[2]
   vLocal[0] = Round(vLocal[0] / aiSnapUnits) * aiSnapUnits + (fPosition[0] * aiSnapUnits)
   vLocal[1] = Round(vLocal[1] / aiSnapUnits) * aiSnapUnits + (fPosition[1] * aiSnapUnits)
   vLocal[2] = Round(vLocal[2] / aiSnapUnits) * aiSnapUnits + (fPosition[2] * aiSnapUnits)
   vLocal[0] = vLocal[0] + fOffsets[0]
   vLocal[1] = vLocal[1] + fOffsets[1]
   vLocal[2] = vLocal[2] + fOffsets[2]
Else
   vLocal[0] = vLocal[0] + fPosition[0]
   vLocal[1] = vLocal[1] + fPosition[1]
   vLocal[2] = vLocal[2] + fPosition[2]
EndIf
;
; Transform back, by multiplying by the transpose.
;
fReturnValue[0] = afMatrixTransformToLocal[0]*vLocal[0] + afMatrixTransformToLocal[3]*vLocal[1] + afMatrixTransformToLocal[6]*vLocal[2]
fReturnValue[1] = afMatrixTransformToLocal[1]*vLocal[0] + afMatrixTransformToLocal[4]*vLocal[1] + afMatrixTransformToLocal[7]*vLocal[2]
fReturnValue[2] = afMatrixTransformToLocal[2]*vLocal[0] + afMatrixTransformToLocal[5]*vLocal[1] + afMatrixTransformToLocal[8]*vLocal[2]</pre>
            <p>
               The vector-by-matrix multiplication performed at the start and end of that code 
               snippet is equivalent to what ApplyTransformationMatrix does.
            </p>
         
         <section>
            <h2>Declaration</h2>
            <pre>Float[] Function ApplySnappedOffsetToPosition(Float[] afBasePosition, Float[] afSnapPosition, Float[] afPositionChange, Float[] afMatrixTransformToLocal, Int aiSnapUnits) Global Native</pre>
         </section>
         
            <h2>Parameters</h2>
            <ul class="papyrus-args">
               
                  <li>
                     <label>afBasePosition</label><!--
                  -->
                  </li>
               
                  <li>
                     <label>afSnapPosition</label><!--
                  -->
                  </li>
               
                  <li>
                     <label>afPositionChange</label><!--
                  -->
                  </li>
               
                  <li>
                     <label>afMatrixTransformToLocal</label><!--
                  -->
                  </li>
               
                  <li>
                     <label>aiSnapUnits</label><!--
                  -->
                  </li>
               
            </ul>
         
         <section>
            <h2>Example</h2>
            <pre>Float[] result = CobbAPIRotations.ApplySnappedOffsetToPosition(afBasePosition, afSnapPosition, afPositionChange, afMatrixTransformToLocal, aiSnapUnits)</pre>
         </section>
         
         
            <h2>See also</h2>
            <ul>
               
                  <li>
                     <a href="../../classes/CobbAPIRotations/ApplyTransformationMatrix.html">
                        
                        ApplyTransformationMatrix
                     </a>
                  </li>
               
                  <li>
                     <a href="../../classes/CobbAPIRotations/ComputeTransformationMatrix.html">
                        
                        ComputeTransformationMatrix
                     </a>
                  </li>
               
            </ul>
         
      </main>
      
      
      
      
      
      
      
      
      
   
</body></html>